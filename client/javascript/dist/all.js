function dragLeave(e,t){e.style.opacity=1}function dragOver(e,t){e.style.opacity=.3,t.preventDefault()}function dragStart(e,t){dragSource=e,t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/html",e.innerHTML)}function dragDrop(e,t){if(e.style.opacity=1,t.stopPropogation&&t.stopPropogation(),dragSource!=e){var o=dragSource.id;dragSource.innerHTML=e.innerHTML,dragSource.id=e.id,e.id=o,e.innerHTML=t.dataTransfer.getData("text/html")}return!1}function deleteBlock(e){var t="";_.forEach(document.getElementById("viewEditor").childNodes,function(o){o.id!==e&&(t+="{{-"+o.id+"}}\n")}),angular.element($("#viewEditor")).scope().deleteBlock(t)}var app=angular.module("dash",["ui.router","ngCookies","ngMaterial","wu.masonry","ui.ace"]);app.config(["$stateProvider","$urlRouterProvider","$mdThemingProvider",function(e,t,o){o.definePalette("yeti",{50:"f8f8f8",100:"333333",200:"0d47a1",300:"0d47a1",400:"0d47a1",500:"0d47a1",600:"0d47a1",700:"0d47a1",800:"0d47a1",900:"0d47a1",A100:"0d47a1",A200:"0d47a1",A400:"0d47a1",A700:"0d47a1",contrastDefaultColor:"light"}),o.theme("default").primaryPalette("blue",{"default":"800"}).accentPalette("yeti",{"default":"500","hue-1":"50","hue-2":"100"}),t.otherwise("/"),e.state("home",{url:"/",templateUrl:"/javascript/app/admin/admin.html",controller:"adminController"}).state("users",{url:"/users",templateUrl:"/javascript/app/users/users.html",controller:"userController"}).state("login",{url:"/login",templateUrl:"/javascript/app/login/login.html",controller:"loginController"}).state("changepass",{url:"/changepass",templateUrl:"/javascript/app/changepass/changepass.html",controller:"changepassController"}).state("views",{url:"/views",templateUrl:"/javascript/app/views/views.html",controller:"viewsController",params:{viewId:{value:null}}}).state("blocks",{url:"/blocks",templateUrl:"/javascript/app/blocks/blocks.html",controller:"blocksController",params:{blockId:{value:null}}}).state("posts",{url:"/posts",templateUrl:"/javascript/app/posts/posts.html",controller:"postsController",params:{postId:{value:null}}}).state("styles",{url:"/styles",templateUrl:"/javascript/app/styles/styles.html",controller:"stylesController",params:{styleId:{value:null}}}).state("scripts",{url:"/scripts",templateUrl:"/javascript/app/scripts/scripts.html",controller:"scriptsController",params:{scriptId:{value:null}}}).state("gallery",{url:"/gallery",templateUrl:"/javascript/app/gallery/gallery.html",controller:"galleryController"})}]).run(["$rootScope","$state",function(e,t){e.$on("$stateChangeSuccess",function(o,n,r,i){t.previous=i,e.current=n.name.charAt(0).toUpperCase()+n.name.slice(1)})}]);var dragSource;app.controller("adminController",["$rootScope","$scope","$state","viewService",function(e,t,o,n){e.isLoading=!1,t.$on("$viewContentLoaded",function(){t.refreshAuth()["catch"](function(){o.go("login")})}),t.$on("$stateChangeSuccess",function(){n.getViews().then(function(e){t.views=e})})}]),app.controller("blocksController",["$rootScope","$scope","$state","$stateParams","$http","$timeout","$mdDialog","loaderService","blockService","$mdToast",function(e,t,o,n,r,i,c,a,s,l){function d(){a.show(),s.getBlocks(!0).then(function(e){t.model.blocks=e,s.setSelectedBlockId(e[0]._id),t.model.currentBlockId=s.getSelectedBlockId(),r.get("/api/posts/categories").then(function(e){t.model.postCategories=e.data,u(),a.hide()})})}function u(e){var o=s.getBlockById(e||s.getSelectedBlockId());t.model.currentBlock=o,"blog"===o.type?(t.model.blockSettings={numToDisplay:o.numPosts,displayTitles:o.displayTitles,displayedCategories:o.displayedCategories||[]},t.model.isBlog=!0):(t.model.isBlog=!1,p.froalaEditor({toolbarButtons:["fullscreen","bold","italic","underline","strikeThrough","subscript","superscript","fontFamily","fontSize","|","color","emoticons","inlineStyle","paragraphStyle","|","paragraphFormat","align","formatOL","formatUL","outdent","indent","-","insertLink","insertImage","insertVideo","insertFile","insertTable","|","quote","insertHR","undo","redo","clearFormatting","selectAll","html"]}),p.froalaEditor("html.set",o.content)),i(function(){var e=$("div:contains('Unlicensed Froala Editor')");e[e.length-1].style.visibility="hidden"},350)}t.model={};var p=$("div#editor");t.$on("$stateChangeSuccess",function(e,t){("blocksDefault"===t.name||"blocks"===t.name)&&d()}),t.saveBlock=function(){var e={blockId:t.model.currentBlockId};t.model.isBlog?(e.numPosts=t.model.blockSettings.numToDisplay,e.displayTitles=t.model.blockSettings.displayTitles,e.displayedCategories=t.model.blockSettings.displayedCategories):e.blockContent=p.froalaEditor("html.get"),r({method:"POST",url:"/api/blocks",data:e}).success(function(e){204===e&&l.show(l.simple().content("Block Saved!").position("bottom right").hideDelay(3e3))}).error(function(e){throw new Error(e)})},t.deleteBlock=function(e){var o=c.confirm().title("Are you sure you want to delete this view?").content("This cannot be reversed!").targetEvent(e).ok("Delete").cancel("Cancel");c.show(o).then(function(){r({method:"POST",url:"/api/blocks/deleteBlock",data:{blockId:t.model.currentBlockId}}).success(function(e){e&&d()}).error(function(e){throw new Error(e)})})},t.gotoBlock=function(e){u(e||t.model.currentBlockId)},t.toggle=function(e,t){var o=t.indexOf(e);o>-1?t.splice(o,1):t.push(e)},t.exists=function(e,t){return t.indexOf(e)>-1},t.addBlock=function(){r({method:"POST",url:"/api/blocks/addBlock",data:{blockType:t.model.blockType,blockName:t.model.blockName}}).then(function(e){c.hide(),e&&e.data._id&&e.data.revisions&&200===e.status&&window.location.assign("/admin/#/blocks/"+e.data._id+"/"+e.data.revisions.length)})["catch"](function(e){console.log(e)})},t.showConfirm=function(e){c.show({templateUrl:"/javascript/app/blocks/addBlockModal.html",parent:angular.element(document.body),scope:t,preserveScope:!0,targetEvent:e,clickOutsideToClose:!0})}}]),app.directive("controlPanel",["$timeout",function(e){return{restrict:"E",link:function(t){var o,n=new Snap({element:document.getElementById("page-content-wrapper"),disable:"right",maxPosition:500,transitionSpeed:1,easing:"ease"});t.startHover=function(){o=e(function(){t.toggleMenu()},500)},t.endHover=function(){e.cancel(o)},t.toggleMenu=function(){"left"===n.state().state?n.close():n.open("left"),e.cancel(o)},t.closeMenu=function(){"left"===n.state().state&&n.close(),e.cancel(o)}}}}]),app.directive("userBar",function(){return{templateUrl:"/javascript/app/directives/userBar.html"}}),app.controller("changepassController",["$rootScope","$scope","$state",function(e,t,o){t.passSubmit=function(){t.passwordError={},t.changePass(e.user.name,t.oldPassword,t.newPassword).then(function(){o.go(o.previous.name)})["catch"](function(e){t.passwordError.message=e.data})}}]),app.controller("galleryController",["$rootScope","$scope","$state","$http","loaderService","$mdDialog","$timeout",function(e,t,o,n,r,i,c){var a,s=new Snap({element:document.getElementById("page-content-wrapper"),disable:"right",maxPosition:500,transitionSpeed:1,easing:"ease"});t.$on("$stateChangeSuccess",function(e,o){"gallery"===o.name&&(r.show(),t.getMedia())}),t.showConfirm=function(e,o){var n=i.confirm().title("Are you sure you want to delete "+o+"?").content("This cannot be reversed!").ariaLabel("Lucky day").targetEvent(e).ok("DELETE").cancel("Cancel");i.show(n).then(function(){t.deleteImage(o)},function(){})},t.getMedia=function(){n({method:"GET",url:"/api/media"}).success(function(e){t.mediaList=e,r.hide()}).error(function(e){throw new Error(e)})},t.submitImage=function(){var e=document.getElementById("inputFile").files[0],t=new FileReader;t.onloadend=function(t){r.show();var o=t.target.result;n({method:"POST",url:"/api/media",data:{file_name:e.name,media_data:o}}).success(function(e){204===e&&(r.hide(),location.reload())}).error(function(e){throw new Error(e)})},t.readAsBinaryString(e)},t.deleteImage=function(e){n({method:"POST",url:"/api/media/deleteImg",data:{fileName:e}}).success(function(e){204===e&&location.reload()}).error(function(e){throw new Error(e)})},t.displayImage=function(e){var t=e.split(".").pop();return("svg"===t?"/images/":"/images/thumbs/thumb_")+e},t.startHover=function(){a=c(function(){t.toggleMenu()},500)},t.endHover=function(){c.cancel(a)},t.toggleMenu=function(){"left"===s.state().state?s.close():s.open("left"),c.cancel(a)},t.closeMenu=function(){"left"===s.state().state&&s.close(),c.cancel(a)}}]),app.controller("postsController",["$rootScope","$scope","$state","$http","$mdDialog","$cookies","loaderService","postService","$mdToast","$timeout",function(e,t,o,n,r,i,c,a,s,l){function d(e){c.show(),a.getPosts(!0).then(function(o){t.model.posts=o,e?(u(e),t.model.currentPost=a.getPostById(e),t.model.currentPostId=e):(u(t.model.posts[0]._id),t.model.currentPost=a.getPostById(t.model.posts[0]._id),t.model.currentPostId=t.model.posts[0]._id),c.hide()})}function u(e){var o=a.getPostById(e||a.getSelectedPostId());t.model.currentPost=o,t.model.postCategory=o.category,p.froalaEditor({toolbarButtons:["fullscreen","bold","italic","underline","strikeThrough","subscript","superscript","fontFamily","fontSize","|","color","emoticons","inlineStyle","paragraphStyle","|","paragraphFormat","insertLink","insertImage","insertVideo","insertFile","|","align","formatOL","formatUL","outdent","indent","-","insertTable","|","quote","insertHR","undo","redo","clearFormatting","selectAll","html"],imageManagerLoadURL:"/api/media/editorList",imageUploadURL:"/api/media/editorUpload"}),p.froalaEditor("html.set",o.content),l(function(){var e=$("div:contains('Unlicensed Froala Editor')");e[e.length-1].style.visibility="hidden"},350)}var p=$("div#editor");t.model={},t.model.posts=[],t.$on("$stateChangeSuccess",function(e,t){("postsDefault"===t.name||"posts"===t.name)&&d()}),t.gotoPost=function(e){u(e||t.model.currentPostId)},t.savePost=function(){n({method:"POST",url:"/api/posts",data:{postId:t.model.currentPostId,postContent:p.froalaEditor("html.get"),postCategory:t.model.postCategory}}).success(function(e){204===e&&s.show(s.simple().content("Post Saved!").position("bottom right").hideDelay(3e3))}).error(function(e){throw new Error(e)})},t.deletePost=function(e){var o=r.confirm().title("Are you sure you want to delete this post?").content("This cannot be reversed!").targetEvent(e).ok("Delete").cancel("Cancel");r.show(o).then(function(){n({method:"POST",url:"/api/posts/deletePost",data:{postId:t.model.currentPostId}}).success(function(e){e&&d()}).error(function(e){throw new Error(e)})},function(){})},t.addPost=function(){n({method:"POST",url:"/api/users/verifytoken",data:{token:i.get("authToken")}}).success(function(e){n({method:"POST",url:"/api/posts/addPost",data:{postName:t.model.postName,author:e.decoded.userId}}).then(function(e){r.hide(),d(e.data._id)})["catch"](function(e){console.log(e)})})},t.showConfirm=function(e){r.show({templateUrl:"/javascript/app/posts/addPostModal.html",scope:t,preserveScope:!0,parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0})}}]),app.controller("scriptsController",["$rootScope","$scope","$state","$stateParams","$http","loaderService","scriptService","$mdDialog","$mdToast",function(e,t,o,n,r,i,c,a,s){function l(e){i.show(),c.getScripts(!0).then(function(o){t.model.scripts=o,e?(d(e),t.model.currentScript=c.getScriptById(e),t.model.currentScriptId=e):(d(t.model.scripts[0]._id),t.model.currentScript=c.getScriptById(t.model.scripts[0]._id),t.model.currentScriptId=t.model.scripts[0]._id),i.hide()})}function d(e){var o=c.getScriptById(e||c.getSelectedScriptId());t.model.currentScript=o,t.model.scriptType=o.type}t.model={},t.model.scripts=[],t.model.options={allowedContent:!0,extraPlugins:"save"},t.saveScript=function(){r({method:"POST",url:"/api/scripts",data:{enabled:t.model.currentScript.enabled,scriptId:t.model.currentScriptId,scriptContent:t.model.currentScript.content,scriptType:t.model.currentScript.type}}).success(function(e){204===e&&s.show(s.simple().content("Script Saved!").position("bottom right").hideDelay(3e3))}).error(function(e){throw new Error(e)})},t.gotoScript=function(e){d(e||t.model.currentScriptId)},t.deleteScript=function(e){var o=a.confirm().title("Are you sure you want to delete this script?").content("This cannot be reversed!").targetEvent(e).ok("Delete").cancel("Cancel");a.show(o).then(function(){r({method:"POST",url:"/api/scripts/deleteScript",data:{scriptId:t.model.currentScriptId}}).success(function(e){e&&l()}).error(function(e){throw new Error(e)})})},t.aceLoaded=function(e){e.setTheme("ace/theme/github"),e.getSession().setMode("ace/mode/css")},t.$on("$stateChangeSuccess",function(e,t){("scriptsDefault"===t.name||"scripts"===t.name)&&l()}),t.addScript=function(){r({method:"POST",url:"/api/scripts/addScript",data:{scriptType:t.model.scriptType,scriptName:t.model.scriptName}}).then(function(e){a.hide(),l(e.data._id)})["catch"](function(e){console.log(e)})},t.showConfirm=function(e){a.show({templateUrl:"/javascript/app/scripts/addScriptModal.html",scope:t,preserveScope:!0,parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0})}}]),app.controller("loginController",["$rootScope","$scope","$state",function(e,t,o){t.loginSubmit=function(){t.loginError={},t.verifyUser(t.inputUser,t.inputPassword).then(function(e){e.data.success?(delete t.loginError.message,t.setToken(t.inputUser,e.data.token),o.go(o.previous.name||"home")):t.loginError.message="Username and/or password incorrect."})["catch"](function(e){t.loginError.message=e.data})}}]),app.factory("blockService",["$q","$http",function(e,t){function o(){return t.get("/api/blocks").then(function(e){return n=e.data})["catch"](function(e){console.log(e)})}var n,r,i={};return i.setSelectedBlockId=function(e){r=e},i.getSelectedBlockId=function(){return r},i.setBlocks=function(){return o()},i.getBlocks=function(t){return!n||t?o().then(function(e){return n}):e.when(n)},i.getBlockById=function(e){return _.find(n,{_id:e})},i}]),app.factory("loaderService",["$rootScope","$timeout",function(e,t){var o,n={},r=300;return n.show=function(){o=!0,t(function(){o&&(e.isLoading=!0,o=!0)},r)},n.hide=function(){o=!1,e.isLoading=!1},n}]),app.factory("postService",["$q","$http",function(e,t){function o(){return t.get("/api/posts").then(function(e){return n=e.data})["catch"](function(e){console.log(e)})}var n,r,i={};return i.setSelectedPostId=function(e){r=e},i.getSelectedPostId=function(){return r},i.setPosts=function(){return o()},i.getPosts=function(t){return!n||t?o().then(function(e){return n}):e.when(n)},i.getPostById=function(e){return _.find(n,{_id:e})},i}]),app.factory("scriptService",["$q","$http",function(e,t){function o(){return t.get("/api/scripts").then(function(e){return n=e.data})["catch"](function(e){console.log(e)})}var n,r,i={};return i.setSelectedScriptId=function(e){r=e},i.getSelectedScriptId=function(){return r},i.setScripts=function(){return o()},i.getScripts=function(t){return!n||t?o().then(function(e){return n}):e.when(n)},i.getScriptById=function(e){return _.find(n,{_id:e})},i}]),app.factory("styleService",["$q","$http",function(e,t){function o(){return t.get("/api/styles").then(function(e){return n=e.data})["catch"](function(e){console.log(e)})}var n,r,i={};return i.setSelectedStyleId=function(e){r=e},i.getSelectedStyleId=function(){return r},i.setStyles=function(){return o()},i.getStyles=function(t){return!n||t?o().then(function(e){return n}):e.when(n)},i.getStyleById=function(e){return _.find(n,{_id:e})},i}]),app.factory("viewService",["$q","$http",function(e,t){function o(){return t.get("/api/views/edit").then(function(e){return n=e.data})["catch"](function(e){console.log(e)})}var n,r,i={};return i.setSelectedViewId=function(e){r=e},i.getSelectedViewId=function(){return r},i.setViews=function(){return o()},i.getViews=function(t){return!n||t?o().then(function(e){return n}):e.when(n)},i.getViewById=function(e){return _.find(n,{id:e})},i.getDefaultView=function(){return _.find(n,{defaultView:!0})},i}]),app.controller("stylesController",["$rootScope","$scope","$state","$stateParams","$http","loaderService","styleService","$mdDialog","$mdToast",function(e,t,o,n,r,i,c,a,s){function l(e){i.show(),c.getStyles(!0).then(function(o){t.model.styles=o,e?(d(e),t.model.currentStyle=c.getStyleById(e),t.model.currentStyleId=e):(d(t.model.styles[0]._id),t.model.currentStyle=c.getStyleById(t.model.styles[0]._id),t.model.currentStyleId=t.model.styles[0]._id),i.hide()})}function d(e){var o=c.getStyleById(e||c.getSelectedStyleId());t.model.currentStyle=o,t.model.styleType=o.type}t.model={},t.model.styles=[],t.model.options={allowedContent:!0,extraPlugins:"save"},t.saveStyle=function(){r({method:"POST",url:"/api/styles",data:{enabled:t.model.currentStyle.enabled,styleId:t.model.currentStyleId,styleContent:t.model.currentStyle.content,styleType:t.model.currentStyle.type}}).success(function(e){204===e&&s.show(s.simple().content("Stylesheet Saved!").position("bottom right").hideDelay(3e3))}).error(function(e){throw new Error(e)})},t.gotoStyle=function(e){d(e||t.model.currentStyleId)},t.deleteStyle=function(e){var o=a.confirm().title("Are you sure you want to delete this style?").content("This cannot be reversed!").targetEvent(e).ok("Delete").cancel("Cancel");a.show(o).then(function(){r({method:"POST",url:"/api/styles/deleteStyle",data:{styleId:t.model.currentStyleId}}).success(function(e){e&&l()}).error(function(e){throw new Error(e)})})},t.aceLoaded=function(e){e.setTheme("ace/theme/github"),e.getSession().setMode("ace/mode/css")},t.$on("$stateChangeSuccess",function(e,t){("stylesDefault"===t.name||"styles"===t.name)&&l()}),t.addStyle=function(){r({method:"POST",url:"/api/styles/addStyle",data:{styleType:t.model.styleType,styleName:t.model.styleName}}).then(function(e){a.hide(),l(e.data._id)})["catch"](function(e){console.log(e)})},t.showConfirm=function(e){a.show({templateUrl:"/javascript/app/styles/addStyleModal.html",scope:t,preserveScope:!0,parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0})}}]),app.controller("userController",["$rootScope","$scope","$q","$http","$state","$cookies","$mdDialog","loaderService",function(e,t,o,n,r,i,c,a){function s(){return n.get("/api/users").then(function(e){return e})["catch"](function(e){return e})}t.$on("$stateChangeSuccess",function(e,o){"users"===o.name&&(a.show(),s().then(function(e){t.userList=e.data,a.hide()})["catch"](function(e){console.log(e)}))}),t.verifyUser=function(e,t){return n({method:"POST",url:"/api/users/verify",data:{username:e,password:t}}).success(function(e){return e}).error(function(e){return e})},t.verifyToken=function(e){return n({method:"POST",url:"/api/users/verifytoken",data:{token:e}}).success(function(e){return e}).error(function(e){return e})},t.logout=function(){i.remove("authToken"),r.go("login")},t.changePass=function(e,t,o){return n({method:"POST",url:"/api/users/changepass",data:{username:e,oldpassword:t,newpassword:o}}).success(function(e){return e}).error(function(e){return e})},t.setToken=function(t,o){i.put("authToken",o),e.verified=!0,e.user={name:t}},t.refreshAuth=function(){var n=o.defer(),r=i.get("authToken");return t.verifyToken(r).then(function(t){200===t.status?(e.verified=!0,e.user={name:t.data.decoded.userName},n.resolve(!0)):n.reject(401)})["catch"](function(e){n.reject(e)}),n.promise},t.refreshAuth()["catch"](function(){r.go("login")}),t.userSubmit=function(){n({method:"POST",url:"/api/users/register",data:{firstRun:!0,username:t.inputUsername,password:t.inputPassword,email:t.inputEmail}}).success(function(e){t.verifyUser(t.inputUsername,t.inputPassword).then(function(e){e.data.success&&(c.hide(),r.go(r.current,{},{reload:!0}))})}).error(function(e){throw new Error(e)})},t.deleteUser=function(e,t){var o=c.confirm().title("Are you sure you want to delete this user?").content("This cannot be reversed!").targetEvent(e).ok("Delete").cancel("Cancel");c.show(o).then(function(){n({method:"POST",url:"/api/users/delete/"+t}).success(function(){r.go(r.current,{},{reload:!0})}).error(function(e){throw new Error(e)})},function(){})},t.showConfirm=function(e){c.show({templateUrl:"/javascript/app/users/addUserModal.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0})}}]),app.controller("viewsController",["$rootScope","viewService","$scope","$state","$http","$mdDialog","loaderService","$stateParams","$sce","$q","$mdToast","blockService",function(e,t,o,n,r,i,c,a,s,l,d,u){function p(e){c.show(),t.getViews(!0).then(function(n){if(o.model.views=n,e)f(e),o.model.currentView=t.getViewById(e),o.model.currentViewId=e;else{var r=t.getDefaultView();r&&(f(r.id),o.model.currentView=t.getViewById(r.id),o.model.currentViewId=r.id)}c.hide()})}function f(e){var n=e||o.model.currentViewId;n&&(o.model.blocks=[],u.getBlocks().then(function(e){_.each(e,function(e,t){o.model.blocks.push({id:e._id,index:t,title:e.title})}),t.setSelectedViewId(n);var r=t.getViewById(n);~r.content.indexOf("{{")?m(r.content).then(function(e){o.model.editorContent=s.trustAsHtml(e)})["catch"](function(e){console.log(e)}):o.model.editorContent=s.trustAsHtml(r.content)})["catch"](function(e){console.log(e)}))}function m(e){var t=l.defer(),o="",n=e.split(/\n/);return _.forEach(n,function(e){var t=/{{-([\s\S]*?)}}/g.exec(e)[1],n=u.getBlockById(t);n.content="blog"===n.type?"Blog Post Block":n.content,o+='<div id="'+n._id+'"class="blockContent" draggable="true"onDragStart="dragStart(this, event)"onDrop="dragDrop(this, event)"onDragOver="dragOver(this, event)"onDragLeave="dragLeave(this, event)">'+n.content+'<div class="blockControlBox"><a href="/admin/#/blocks/'+n._id+'"><i class="btn fa fa-pencil fa-4x""></i></a><i class="btn fa fa-trash-o fa-4x" onclick="deleteBlock(\''+n._id+"')\"></i></div></div>"}),t.resolve(o),t.promise}function h(){var e="";return _.forEach(document.getElementById("viewEditor").childNodes,function(t){t.id&&(e+="{{-"+t.id+"}}\n")}),e}function g(e){r({method:"POST",url:"/api/views",data:{viewId:o.model.currentViewId,viewContent:e.replace(/\n$/,""),viewRoute:o.model.currentView.route,viewIsDefault:o.model.currentView.defaultView}}).success(function(e){204===e&&t.setViews().then(function(){p(o.model.currentViewId),d.show(d.simple().content("View Saved!").position("bottom right").hideDelay(3e3))})}).error(function(e){throw new Error(e)})}o.model={},o.model.selectedBlock="",o.$on("$stateChangeSuccess",function(e,t){("viewsDefault"===t.name||"views"===t.name)&&p()}),o.addView=function(){r({method:"POST",url:"/api/views/addView",data:{viewName:o.model.viewName}}).then(function(e){i.hide(),200===e.status&&p(e.data._id)})["catch"](function(e){console.log(e)})},o.showConfirm=function(e){i.show({templateUrl:"/javascript/app/views/addViewModal.html",scope:o,preserveScope:!0,parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0})},o.saveView=function(){g(h())},o.deleteView=function(e){var t=i.confirm().title("Are you sure you want to delete this view?").content("This cannot be reversed!").targetEvent(e).ok("Delete").cancel("Cancel");i.show(t).then(function(){r({method:"POST",url:"/api/views/deleteView",data:{viewId:o.model.currentViewId}}).success(function(e){e&&p()}).error(function(e){throw new Error(e)})},function(){})},o.addBlock=function(){g(h()+"{{-"+o.model.selectedBlock+"}}"),f()},o.deleteBlock=function(e){g(e),f()},o.gotoView=function(e){f(e||o.model.currentViewId),o.model.currentView=t.getViewById(e||o.model.currentViewId)}}]);